"use strict";(self["webpackChunkstories"]=self["webpackChunkstories"]||[]).push([[382],{382:function(e,t,s){s.d(t,{diagram:function(){return U}});s(4114),s(8111),s(7588);var o=s(1042),i=s(8668),n=s(6852),r=s(9359),a=s(6212);s(3512),s(1576),s(2457),s(8179),s(7478),s(1636);const d="rect",c="rectWithTitle",l="start",p="end",b="divider",g="roundedWithTitle",u="note",h="noteGroup",y="statediagram",f="state",$=`${y}-${f}`,w="transition",x="note",m="note-edge",T=`${w} ${m}`,k=`${y}-${x}`,S="cluster",v=`${y}-${S}`,D="cluster-alt",A=`${y}-${D}`,B="parent",L="note",C="state",E="----",R=`${E}${L}`,V=`${E}${B}`,N="fill:none",M="fill: #333",z="c",I="text",P="normal";let W={},j=0;const G=function(e){const t=Object.keys(e);for(const s of t)e[s]},O=function(e,t){return t.db.extract(t.db.getRootDocV2()),t.db.getClasses()};function q(e){return void 0===e||null===e?"":e.classes?e.classes.join(" "):""}function _(e="",t=0,s="",o=E){const i=null!==s&&s.length>0?`${o}${s}`:"";return`${C}-${e}${i}-${t}`}const F=(e,t,s,i,n,a)=>{const y=s.id,f=q(i[y]);if("root"!==y){let t=d;!0===s.start&&(t=l),!1===s.start&&(t=p),s.type!==o.D&&(t=s.type),W[y]||(W[y]={id:y,shape:t,description:r.e.sanitizeText(y,(0,r.c)()),classes:`${f} ${$}`});const i=W[y];s.description&&(Array.isArray(i.description)?(i.shape=c,i.description.push(s.description)):i.description.length>0?(i.shape=c,i.description===y?i.description=[s.description]:i.description=[i.description,s.description]):(i.shape=d,i.description=s.description),i.description=r.e.sanitizeTextOrArray(i.description,(0,r.c)())),1===i.description.length&&i.shape===c&&(i.shape=d),!i.type&&s.doc&&(r.l.info("Setting cluster for ",y,J(s)),i.type="group",i.dir=J(s),i.shape=s.type===o.a?b:g,i.classes=i.classes+" "+v+" "+(a?A:""));const n={labelStyle:"",shape:i.shape,labelText:i.description,classes:i.classes,style:"",id:y,dir:i.dir,domId:_(y,j),type:i.type,padding:15,centerLabel:!0};if(s.note){const t={labelStyle:"",shape:u,labelText:s.note.text,classes:k,style:"",id:y+R+"-"+j,domId:_(y,j,L),type:i.type,padding:15},o={labelStyle:"",shape:h,labelText:s.note.text,classes:i.classes,style:"",id:y+V,domId:_(y,j,B),type:"group",padding:0};j++;const r=y+V;e.setNode(r,o),e.setNode(t.id,t),e.setNode(y,n),e.setParent(y,r),e.setParent(t.id,r);let a=y,d=t.id;"left of"===s.note.position&&(a=t.id,d=y),e.setEdge(a,d,{arrowhead:"none",arrowType:"",style:N,labelStyle:"",classes:T,arrowheadStyle:M,labelpos:z,labelType:I,thickness:P})}else e.setNode(y,n)}t&&"root"!==t.id&&(r.l.trace("Setting node ",y," to be child of its parent ",t.id),e.setParent(y,t.id)),s.doc&&(r.l.trace("Adding nodes children "),H(e,s,s.doc,i,n,!a))},H=(e,t,s,i,n,a)=>{r.l.trace("items",s),s.forEach(s=>{switch(s.stmt){case o.b:F(e,t,s,i,n,a);break;case o.D:F(e,t,s,i,n,a);break;case o.S:{F(e,t,s.state1,i,n,a),F(e,t,s.state2,i,n,a);const o={id:"edge"+j,arrowhead:"normal",arrowTypeEnd:"arrow_barb",style:N,labelStyle:"",label:r.e.sanitizeText(s.description,(0,r.c)()),arrowheadStyle:M,labelpos:z,labelType:I,thickness:P,classes:w};e.setEdge(s.state1.id,s.state2.id,o,j),j++}break}})},J=(e,t=o.c)=>{let s=t;if(e.doc)for(let o=0;o<e.doc.length;o++){const t=e.doc[o];"dir"===t.stmt&&(s=t.value)}return s},K=async function(e,t,s,o){r.l.info("Drawing state diagram (v2)",t),W={},o.db.getDirection();const{securityLevel:c,state:l}=(0,r.c)(),p=l.nodeSpacing||50,b=l.rankSpacing||50;r.l.info(o.db.getRootDocV2()),o.db.extract(o.db.getRootDocV2()),r.l.info(o.db.getRootDocV2());const g=o.db.getStates(),u=new i.T({multigraph:!0,compound:!0}).setGraph({rankdir:J(o.db.getRootDocV2()),nodesep:p,ranksep:b,marginx:8,marginy:8}).setDefaultEdgeLabel(function(){return{}});let h;F(u,void 0,o.db.getRootDocV2(),g,o.db,!0),"sandbox"===c&&(h=(0,n.Ltv)("#i"+t));const f="sandbox"===c?(0,n.Ltv)(h.nodes()[0].contentDocument.body):(0,n.Ltv)("body"),$=f.select(`[id="${t}"]`),w=f.select("#"+t+" g");await(0,a.r)(w,u,["barb"],y,t);const x=8;r.u.insertTitle($,"statediagramTitleText",l.titleTopMargin,o.db.getDiagramTitle());const m=$.node().getBBox(),T=m.width+2*x,k=m.height+2*x;$.attr("class",y);const S=$.node().getBBox();(0,r.i)($,k,T,l.useMaxWidth);const v=`${S.x-x} ${S.y-x} ${T} ${k}`;r.l.debug(`viewBox ${v}`),$.attr("viewBox",v);const D=document.querySelectorAll('[id="'+t+'"] .edgeLabel .label');for(const i of D){const e=i.getBBox(),t=document.createElementNS("http://www.w3.org/2000/svg",d);t.setAttribute("rx",0),t.setAttribute("ry",0),t.setAttribute("width",e.width),t.setAttribute("height",e.height),i.insertBefore(t,i.firstChild)}},Q={setConf:G,getClasses:O,draw:K},U={parser:o.p,db:o.d,renderer:Q,styles:o.s,init:e=>{e.state||(e.state={}),e.state.arrowMarkerAbsolute=e.arrowMarkerAbsolute,o.d.clear()}}}}]);
//# sourceMappingURL=382.466e6c86.js.map