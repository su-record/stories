---
title: "fallingo 개발일지 - 901ac2b..0da4be2 (10개 커밋)"
date: "2026-01-24"
category: "dev-log"
description: "Docker, CI 최적화 및 GCP Vision에서 Azure Content Safety 마이그레이션."
tags: ["fallingo", "개발일지", "FastAPI", "Docker", "CI/CD", "Azure"]
author: "Su"
lang: "ko"
---

안녕하세요, Fallingo 프로젝트 개발자 Su입니다. 👋

이번 주(2026-01-24)는 기능 구현보다는 제가 새로 배우고 있는 Python/FastAPI 백엔드 환경을 안정화하는 데 대부분의 시간을 쏟았습니다. 특히 CI/CD 파이프라인과 Docker 배포 환경을 다듬는 과정에서 겪는 사소한 환경 변수 문제와 빌드 에러들이 많았는데요.

이번 기간 동안 10개의 커밋을 통해 인프라의 뼈대를 단단하게 만들고, 핵심 AI 검증 모듈을 마이그레이션하는 큰 작업을 진행했습니다.

## 📝 이번 기간 작업 내용

총 10개의 커밋 내역을 기반으로 핵심 작업 내용을 인프라, CI/CD, 그리고 백엔드 마이그레이션 세 가지 영역으로 그룹화했습니다. 대부분이 `fix:` 커밋이었던 만큼, 안정성에 초점을 맞췄습니다.

| 영역 | 주요 작업 개수 | 커밋 타입 | 핵심 내용 |
| :--- | :--- | :--- | :--- |
| **I. 인프라 및 배포** | 4개 | `fix`, `refactor` | Docker 빌드 속도 개선 및 Uvicorn 실행 환경 설정 |
| **II. CI/CD 및 테스트** | 5개 | `fix`, `chore` | GitHub Actions 캐싱 및 Poetry 의존성/보안 문제 해결 |
| **III. 핵심 기능 마이그레이션** | 1개 | `refactor` | 콘텐츠 안전 검사 서비스 교체 |

### I. 인프라 및 배포 환경 안정화 (4 fixes)

Fallingo는 궁극적으로 Docker 컨테이너 기반으로 배포될 예정이기 때문에, 개발 초기부터 Docker 환경을 깔끔하게 만드는 것이 중요했습니다. 특히 Poetry 의존성 관리와 Docker 빌드 간의 충돌을 해결하는 데 집중했습니다.

1.  **Dockerfile 최적화 및 단순화**
    *   `fix: Dockerfile 단순화 - multi-stage 제거`: 초기에는 multi-stage 빌드를 시도했으나, Python 환경에서 불필요하게 복잡성을 높이는 것 같아 단일 스테이지로 간소화했습니다. 아직 프로덕션 환경에 최적화할 단계는 아니라고 판단하고, 일단 작동하는 깔끔한 환경을 만드는 것이 우선이었습니다.
    *   `fix: Dockerfile에 poetry lock 추가`: Poetry 환경에서 의존성 충돌을 방지하기 위해 `poetry.lock` 파일을 Docker 빌드 시 명시적으로 사용하도록 변경하여 일관성을 확보했습니다.

2.  **FastAPI 실행 환경 수정**
    *   `fix: uvicorn not found - python -m uvicorn 사용`: Docker 환경에서 `uvicorn`을 직접 실행했을 때 종종 PATH를 찾지 못하는 문제가 발생했습니다. 파이썬 모듈로 실행하는 (`python -m uvicorn`) 방식을 채택하여 환경 독립성을 높였습니다. 😥

3.  **Redis 환경변수 유연성 확보**
    *   `fix: Redis 개별 환경변수 지원`: Redis 연결 설정 시 `REDIS_URL` 하나만 쓰는 것보다, `REDIS_HOST`, `REDIS_PORT`, `REDIS_PASSWORD`를 개별로 받아 환경 구성을 유연하게 만들었습니다. (개발 환경/로컬 환경 테스트 시 유용합니다.)

### II. CI/CD 및 테스트 워크플로우 안정화 (5 fixes, 1 chore)

Poetry와 GitHub Actions 캐싱, 그리고 테스트 코드 설정이 미묘하게 맞지 않아 여러 번 테스트 워크플로우를 고치는 작업을 반복했습니다.

1.  **테스트 환경 세팅**
    *   `fix: 테스트 환경 수정 및 aiosqlite 추가`: 테스트를 위해 임시 데이터베이스로 `aiosqlite`를 추가했습니다. 실제 PostgreSQL 환경과 테스트 환경을 분리하는 과정이 필수적입니다.
    *   `fix: 테스트 워크플로우 캐시 및 import 에러 수정`: CI 실행 시간을 줄이기 위해 캐싱 전략을 수정했으나, 초기에는 이로 인해 import 에러가 발생하여 이 부분을 잡았습니다.

2.  **보안 및 의존성 관리**
    *   `fix: poetry lock 명령어 수정 및 미출시 CVE 무시`: 의존성 관리 도중 미출시된 CVE(취약점) 경고가 발생하여, CI가 실패하는 것을 방지하기 위해 임시로 해당 경고를 무시하도록 설정했습니다. (물론 프로덕션 전에는 반드시 해결해야 합니다!)
    *   `chore: 정리 - 불필요한 문서 삭제, 워크플로우 업데이트`: 불필요하게 남아있던 초기 기획 문서를 삭제하고, 워크플로우를 최신화했습니다.

### III. 핵심 기능 마이그레이션 (1 refactor)

Fallingo는 사용자가 업로드하는 음식 사진에 부적절한 콘텐츠(폭력, 선정성 등)가 포함되어 있는지 검증해야 합니다. 이 콘텐츠 안전 검증 API를 교체했습니다.

*   `refactor: GCP Vision → Azure Content Safety 마이그레이션`

저는 Fallingo 프로젝트를 위해 Google for Startups Cloud Program에 선정되어 $2,000 크레딧을 지원받고 있지만, 이번에 콘텐츠 안전성 검증 부분에서는 Azure Content Safety가 Fallingo의 요구사항(특히 유해성 판단 기준)에 더 적합하다고 판단했습니다.

| 서비스 | 이전 | 변경 | 이유 |
| :--- | :--- | :--- | :--- |
| **콘텐츠 검증** | GCP Vision API | Azure Content Safety | 전문성 및 요구사항 부합도 (AI 서비스 비교 평가) |

마이그레이션 자체는 큰 API 변화가 있었지만, 코어 로직이 깔끔하게 분리되어 있어 하루 만에 완료할 수 있었습니다. 이제 Fallingo는 Azure AI 기반으로 이미지를 검증하게 됩니다. 이 부분은 추후 자세한 기술 블로그 포스트로 공유할 예정입니다. 🚀

---

## 💡 작업 하이라이트

### 1. 인프라 설정의 사소함과 중요성

이번 주 작업은 대부분 "사소한 설정 오류"를 잡는 데 집중되었습니다. 특히 파이썬 기반 백엔드를 Docker와 CI/CD에 얹는 과정에서 발생했던 `uvicorn not found` 같은 문제는 경험이 없었다면 며칠을 헤맬 수도 있는 부분이었습니다.

새로운 스택(FastAPI, Poetry, Docker) 조합을 사용하면서 "돌아간다"와 "자동으로 배포된다" 사이의 간극을 뼈저리게 느꼈습니다.

### 2. Azure Content Safety 마이그레이션

가장 의미 있는 변경은 **AI 콘텐츠 검증 모듈의 마이그레이션**입니다.

GCP Vision을 사용하다가 Azure Content Safety로 변경하면서, Fallingo의 콘텐츠 중재 정책을 더 정교하게 만들 수 있는 기반을 마련했습니다. 핵심 API가 교체되었고, 이제 서비스의 안정적인 확장을 위해 중요한 발판을 마련했다고 생각합니다.

이후 GCP 크레딧은 위치 기반 서비스, 혹은 다른 핵심 AI 기능 개발에 집중적으로 사용할 계획입니다.

## 📊 개발 현황

현재 Fallingo는 베타 런칭 목표(2025년 12월)를 향해 나아가고 있습니다.

| 영역 | 진행률 | 설명 |
| :--- | :--- | :--- |
| **백엔드 (FastAPI)** | 80% | 핵심 API (사용자, 위치, 피드) 구현 완료. **인프라 안정화 작업 (현재 주)** 완료. 남은 것은 결제 모듈 연동 및 최종 보안 점검. |
| **프론트엔드 (Flutter)** | 60% | 핵심 UI (피드, 지도 뷰) 구현 완료. 백엔드 API 연동 시작 단계. |
| **인프라/CI** | 95% | Docker, CI/CD, Redis, DB 연결 워크플로우 거의 확정. |

백엔드 인프라 안정화 작업을 통해 이제 본격적으로 프론트엔드(Flutter) 개발과 백엔드 최종 테스트에 집중할 수 있게 되었습니다.

다음 주에는 Flutter에서 백엔드로 실제 이미지를 업로드하고 Azure Content Safety를 통해 검증하는 end-to-end 테스트를 진행할 예정입니다. 기대해주세요! 🙇‍♂️