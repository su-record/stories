---
title: "Fallingo 개발일지 - 2025년 9월 2주차 (09.08 ~ 09.14)"
date: "2025-09-14"
category: "dev-log"
project: "fallingo"
tags: ["배포", "CloudRun", "DevOps", "최적화"]
---

## 이번 주 요약

백엔드 프로덕션 배포와의 전쟁. Cloud Run 배포를 위한 포트 설정, 환경변수, 도메인 패턴 등 온갖 문제를 해결했다. 44개 커밋 중 21개가 fix였다. 하지만 최종적으로 백엔드 완성도를 높이고 Startup Application 통합을 완료했다.

## 주요 작업

### Cloud Run 배포 문제 해결
- PORT 환경변수 충돌 문제
- 컨테이너 시작 최적화
- TrustedHost 미들웨어 설정
- Cloud Run 도메인 패턴 추가

### 백엔드 아키텍처 최적화
- 5단계 Startup Application 통합
- 6단계 기본 API 라우터 통합
- GCP 기반 스케폴딩 완성
- 프로덕션 준비 완료

### 배포 안정성 개선
- 헬스체크 엔드포인트 강화
- 컨테이너 시작 시간 단축
- 에러 로깅 개선
- 모니터링 설정

## 배운 점

**PORT 환경변수의 비밀**

Cloud Run이 PORT 환경변수를 자동으로 주입한다는 것을 몰랐다. FastAPI는 기본 8000 포트를 사용하는데, Cloud Run은 다른 포트를 요구했다. 환경변수에서 PORT를 읽어오는 간단한 코드 한 줄로 해결했지만, 찾는 데 시간이 걸렸다.

**TrustedHost와 보안 사이**

Cloud Run의 도메인 패턴은 복잡했다. `*.run.app`, `*.a.run.app` 등 여러 패턴. 와일드카드 설정이 필요했지만, 보안도 고려해야 했다. 편의성과 보안 사이에서 균형을 찾는 과정이었다.

**로컬에서는 잘 되는데**

로컬에서는 잘 되는데 배포하면 실패하는 경험. Cloud Run 로그를 확인하고, 환경변수 차이를 확인하고, 네트워크 설정을 확인했다. 44개 커밋 중 21개가 버그 수정이었다. 스테이징 환경의 필요성을 절실히 느꼈다.

**라우터 통합의 완성**

FastAPI의 모듈화 구조를 활용해 API 라우터를 통합했다. 각 도메인별로 라우터를 분리하니 코드가 깔끔해졌다. Startup Application 통합도 완료했다. 백엔드의 완성도가 높아지는 것을 느꼈다.
