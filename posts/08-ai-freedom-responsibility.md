---
title: "AI 개발 방법론 8 - 자유에는 책임이 따른다"
date: "2026-01-10"
category: "methodology"
description: "너무 많은 도구와 높은 자유도가 오히려 문제를 만들었다. 74개 커밋과 하루 종일 디버깅 끝에 얻은 교훈"
tags: ["ai-first", "methodology", "agent", "tool-design", "llm-chaining"]
author: "Su"
lang: "ko"
---

# 자유에는 책임이 따른다

> 이전 편: [AI 개발 방법론 7 - 에이전트의 본질](07-ai-agent-essence.md)

## 의미 기반으로 가자

7편에서 패턴 기반에서 의미 기반 프롬프트로 전환했습니다. "이 패턴들 외워"에서 "이렇게 생각해"로 바꿨죠.

성공적이었습니다. "김OO님은?"이라는 질문에 제대로 된 답변이 나왔습니다. 라우팅 프롬프트가 패턴 목록을 암기하는 대신 의미를 파악하도록 바뀌었으니까요.

이 성공에 고무되어 더 나아갔습니다.

"LLM한테 도구만 잘 주면 알아서 다 할 수 있겠네?"

---

## 도구를 잔뜩 줬다

조직 정보 조회를 위해 8개 도구를 만들었습니다.

```python
# 기존 organization_tools.py (8개)
- get_current_user_info_tool    # 현재 사용자 정보
- search_members_tool           # 직원 검색
- search_by_affiliation_tool    # 소속으로 검색
- get_project_members_tool      # 프로젝트 멤버 조회
- search_project_member_by_role_tool  # 프로젝트 역할로 검색
- find_department_leader_tool   # 부서장 찾기
- search_by_position_tool       # 직급으로 검색
- get_departments_tool          # 부서 목록 조회
```

각각 세분화된 목적이 있었습니다. "직원 검색"과 "소속으로 검색"이 다르고, "프로젝트 멤버"와 "부서장 찾기"가 다르니까요.

회의실 예약도 마찬가지였습니다. 검색, 상세조회, 예약생성, 수정, 삭제, 내 예약 조회. 기존 API 구조를 그대로 도구로 만들었습니다.

LLM한테 "이 도구들 있어, 알아서 골라 써"라고 했습니다.

---

## 문제 발생

### 느린 응답

첫 번째 문제는 속도였습니다.

도구가 많으니 LLM이 어떤 도구를 쓸지 판단하는 데 시간이 오래 걸렸습니다. 각 도구의 설명을 읽고, 파라미터를 이해하고, 적절한 것을 선택하는 과정이 매번 필요했습니다.

단순한 "김OO님 정보 알려줘" 요청에도 응답이 느렸습니다.

### 엉뚱한 도구 선택

두 번째 문제는 정확도였습니다.

```
나: "내 팀장님은 누구야?"
에이전트: (search_members_tool 호출) → "팀장" 검색
결과: 전체 조직의 모든 팀장 목록
```

원하는 건 "나의 팀장"이었는데, LLM이 `search_members_tool`을 선택해서 "팀장"이라는 키워드로 전체 검색을 해버렸습니다. `find_department_leader_tool`이 있는데도요.

도구가 너무 많으니 LLM이 가장 범용적인 것을 선택하는 경향이 있었습니다.

### 실패하는 요청들

세 번째 문제는 실패율이었습니다.

복잡한 요청은 아예 실패했습니다. 도구 호출 과정에서 파라미터가 잘못 들어가거나, 필요한 도구를 호출하지 않거나, 결과를 제대로 해석하지 못했습니다.

```
나: "개발팀에서 수석 직급인 사람 알려줘"
에이전트: (search_members_tool 호출) → "개발팀 수석" 검색
결과: 검색 결과 없음
```

"개발팀"과 "수석"을 분리해서 조건을 걸어야 하는데, 하나의 검색어로 합쳐버렸습니다.

---

## 하루 종일 디버깅

오늘 하루가 그랬습니다.

아침부터 에이전트 테스트를 시작했습니다. 간단한 요청조차 제대로 동작하지 않았습니다. 로그를 추가하고, 프롬프트를 수정하고, 도구 호출 방식을 바꾸고. 커밋이 쌓였습니다.

```bash
# 오늘의 커밋들 (일부)
fix: tool.ainvoke(modified_args)로 변경
fix: tool.arun(**args)로 도구 호출 방식 변경
fix: site_cd를 GV01로 하드코딩 (단일 조직)
fix: LangChain tool.ainvoke(input=dict) 방식으로 수정
fix: 도구 함수 직접 호출로 args 전달 문제 해결
fix: ToolNode 우회하여 직접 도구 실행으로 site_cd 주입 문제 해결
```

도구 호출 방식만 수십 번 바꿨습니다. 파라미터가 제대로 전달되지 않는 문제, 컨텍스트가 유실되는 문제, 결과가 이상하게 파싱되는 문제.

총 74개 커밋이 오늘 하루에 쌓였습니다.

---

## 원인을 찾다

저녁이 되어서야 원인이 명확해졌습니다.

### 1. API 기반 도구 설계

도구들이 기존 API 구조를 그대로 따르고 있었습니다.

```python
# API 기반 설계 (문제)
def search_members_tool(keyword: str) -> list:
    """키워드로 직원 검색"""

def search_by_position_tool(position: str) -> list:
    """직급으로 검색"""

def search_by_affiliation_tool(affiliation: str) -> list:
    """소속으로 검색"""
```

UI에서는 이렇게 나뉘어 있는 게 맞습니다. 검색창, 필터, 드롭다운 각각에 대응하는 API니까요.

하지만 에이전트 도구로는 맞지 않았습니다. 자연어는 이렇게 깔끔하게 분리되지 않습니다.

"개발팀 수석" — 이게 소속 검색인가요, 직급 검색인가요, 키워드 검색인가요?

### 2. 너무 많은 선택지

8개 도구. LLM은 매번 8개 중에서 선택해야 했습니다.

선택지가 많을수록 잘못된 선택 확률도 높아집니다. 특히 유사한 목적의 도구들이 여러 개 있으면 LLM이 혼란스러워합니다.

"검색"이라는 동일한 목적에 4개 도구(`search_members`, `search_by_position`, `search_by_affiliation`, `find_department_leader`)가 있었습니다.

### 3. 자연어 파싱의 부재

사용자가 "개발팀 수석"이라고 말하면, 이걸 분해해서 이해해야 합니다.

- 부서: 개발팀
- 직급: 수석

기존 도구들은 이런 파싱을 하지 않았습니다. 입력을 그대로 API에 전달했습니다.

---

## 해결: 도구 통합과 LLM 체이닝

### 8개 → 2개

조직 도구를 2개로 통합했습니다.

```python
# 통합 후 (2개)
- get_current_user_info_tool  # 현재 사용자 정보
- search_members_tool         # 통합 검색 (자연어 지원)
```

### 통합 서비스 레이어

핵심은 `AgentMemberService`입니다.

```python
class AgentMemberService:
    """
    에이전트 전용 조직 검색 서비스

    자연어 쿼리를 분석하여 데이터베이스 조건으로 변환합니다.
    """

    async def search(self, query: str) -> dict:
        """
        자연어 쿼리로 직원 검색

        예시:
        - "개발팀 수석" → 부서=개발팀, 직급=수석
        - "김OO 부장" → 이름=김OO, 직급=부장
        - "프로젝트A PM" → 프로젝트=A, 역할=PM
        """
        # 자연어를 구조화된 조건으로 변환
        conditions = await self._parse_query(query)

        # 조건으로 DB 조회
        results = await self._execute_search(conditions)

        return results
```

### LLM 체이닝

자연어 파싱 과정 자체도 LLM이 담당합니다.

```
사용자: "개발팀 수석 알려줘"

1단계 - 도구 선택 (LLM)
   → search_members_tool 선택

2단계 - 자연어 파싱 (LLM, 서비스 내부)
   → {"departments": ["개발팀"], "positions": ["수석"]}

3단계 - DB 조회 (서비스)
   → SELECT * FROM users WHERE dept='개발팀' AND position='수석'

4단계 - 결과 정리 (LLM)
   → "개발팀 수석은 홍길동님입니다."
```

도구 선택과 결과 정리는 에이전트 LLM이, 자연어 파싱은 서비스 내부 LLM이 담당합니다. 체이닝입니다.

---

## 라우팅도 단순화

도구가 줄어드니 라우팅도 단순해졌습니다.

```python
# 기존: 복잡한 조건들
"""
- 직원 검색이면 organization
- 부서 조회면 organization
- 직급 검색이면 organization
- 프로젝트 멤버면 organization
- ...
"""

# 변경 후: 의미 기반 단순 분류
"""
사람/조직/관계 관련 → organization
회의실/예약 관련 → meeting_room
문서/규정 관련 → regulation
그 외 → general
"""
```

LLM에게 세부적인 도구 선택을 맡기는 대신, 큰 방향만 정해주고 나머지는 통합 도구가 알아서 처리하게 했습니다.

---

## 마이그레이션 시 고려사항

이 과정에서 중요한 걸 하나 더 배웠습니다.

기존 API 기반 시스템을 에이전트로 마이그레이션할 때, **UI 매핑을 고려해야 합니다**.

### 문제 상황

에이전트가 답변을 잘 만들어도, 프론트엔드에서 그걸 표시하지 못하면 소용없습니다.

```python
# 에이전트 답변
{
    "text": "회의실 A가 14:00-15:00에 예약 가능합니다.",
    "room": {"name": "회의실 A", "floor": 3}  # 프론트가 모르는 구조
}
```

프론트엔드는 기존 API 응답 형식에 맞춰 UI가 구현되어 있습니다. 에이전트가 다른 형식으로 답변하면 렌더링이 깨집니다.

### 해결

에이전트 도구가 반환하는 데이터 구조를 **기존 API 스키마와 일치**시켰습니다.

```python
# 도구 반환값이 API 응답 구조를 따름
{
    "success": True,
    "data": {
        "rooms": [...],  # 기존 API와 동일한 구조
        "available_times": [...]
    }
}
```

에이전트의 자연어 답변과 함께, 구조화된 데이터도 같이 내려보냅니다. 프론트엔드는 필요에 따라 자연어를 보여주거나, 기존 UI 컴포넌트로 렌더링할 수 있습니다.

---

## 자유에는 책임이 따른다

오늘 하루의 교훈입니다.

LLM에게 높은 자유도를 주면 강력해 보입니다. "도구 8개 줄 테니 알아서 해봐." 하지만 그 자유도가 오히려 문제를 만들었습니다.

| 높은 자유도 | 제한된 자유도 |
|------------|--------------|
| 도구 8개, 알아서 선택 | 도구 2개, 명확한 역할 |
| 선택 오류 빈번 | 선택이 단순해 정확 |
| 파라미터 혼란 | 자연어를 내부에서 처리 |
| 느린 응답 | 빠른 응답 |

**제한된 자유 안에서 더 잘 동작합니다.**

### 도구 설계 원칙

1. **도구 수는 최소화한다** — 유사 목적의 도구는 통합
2. **자연어 처리는 도구 내부에서** — LLM 체이닝으로 파싱
3. **기존 API 스키마 호환** — UI 매핑 고려
4. **하나의 도구가 하나의 역할** — 명확한 책임 분리

### 에이전트 vs API

이제 확실히 구분됩니다.

- **API**: UI 컴포넌트와 1:1 매핑. 검색창, 필터, 버튼 각각에 대응
- **에이전트 도구**: 자연어 의도와 매핑. "이거 해줘"에 대응

기존 API를 그대로 도구로 만들면 안 됩니다. 에이전트 전용으로 재설계해야 합니다.

---

## 결론

74개 커밋과 하루 종일 디버깅. 삽질이었지만 값진 경험이었습니다.

**배운 것:**

1. **너무 많은 도구는 독이다** — LLM이 선택을 잘못한다
2. **자연어 파싱은 도구 내부에서** — 통합 서비스 + LLM 체이닝
3. **기존 API ≠ 에이전트 도구** — 목적과 설계가 다르다
4. **자유에는 책임이 따른다** — 제한된 자유가 더 안정적

이론으로 배운 게 아니라 삽질로 체득했습니다. 그래서 더 확신합니다.

---

> 이전 편: [AI 개발 방법론 7 - 에이전트의 본질](07-ai-agent-essence.md)

**하루 종일 고생했지만, 결국 정상 동작합니다.**
